<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OralGuard ‚Äî Image Matcher</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Source+Sans+3:wght@300;400;600&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --cream: #f8f4ee; --ink: #1a1208; --rust: #b84c2a; --rust-light: #f0ddd6;
  --rust-mid: #d4623a; --amber: #c98a2e; --sage: #4a7c6b; --sage-light: #dceee9;
  --muted: #7a6e63; --border: #d9cec4; --white: #ffffff; --dark: #0f0b06;
}
html { scroll-behavior: smooth; }
body { background: var(--cream); color: var(--ink); font-family: 'Source Sans 3', sans-serif; font-weight: 300; min-height: 100vh; overflow-x: hidden; }

/* NAV ‚Äî identical to index.html */
nav {
  position: fixed; top: 0; left: 0; right: 0; z-index: 900;
  background: rgba(248,244,238,0.97); backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border);
  padding: 0 40px; display: flex; align-items: center; justify-content: space-between; height: 64px;
}
.nav-logo { display: flex; align-items: center; gap: 10px; cursor: pointer; text-decoration: none; }
.logo-mark { width: 32px; height: 32px; background: var(--rust); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; color: white; font-weight: 700; }
.logo-text { font-family: 'Playfair Display', serif; font-size: 20px; color: var(--ink); }
.logo-text span { color: var(--rust); }
.nav-links { display: flex; align-items: center; gap: 6px; }
.nav-link {
  padding: 7px 14px; font-size: 13px; color: var(--muted);
  cursor: pointer; border-radius: 4px; border: 1px solid transparent;
  background: none; font-family: 'Source Sans 3', sans-serif; transition: all 0.15s;
  text-decoration: none; display: inline-block;
}
.nav-link:hover { color: var(--ink); border-color: var(--border); background: var(--white); }
.nav-link.active { color: var(--rust); border-color: var(--rust-light); background: var(--rust-light); font-weight: 600; }

/* PAGE */
.page { padding: 96px 40px 64px; max-width: 1100px; margin: 0 auto; }

.page-header { margin-bottom: 40px; }
.page-badge { font-size: 10px; letter-spacing: 4px; text-transform: uppercase; color: var(--rust); font-weight: 600; margin-bottom: 10px; }
.page-header h1 { font-family: 'Playfair Display', serif; font-size: clamp(28px, 3.5vw, 40px); margin-bottom: 12px; }
.page-header p { color: var(--muted); max-width: 560px; line-height: 1.75; font-size: 15px; }

/* UPLOAD SECTION */
.upload-section {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: 16px;
  overflow: hidden;
  margin-bottom: 48px;
}

.upload-section-head {
  padding: 18px 26px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #fdfaf7;
}

.upload-section-head h2 {
  font-family: 'Playfair Display', serif;
  font-size: 17px;
}

.self-exam-link {
  display: inline-flex;
  align-items: center;
  gap: 7px;
  font-size: 14px;
  font-weight: 600;
  color: white;
  background: var(--rust-mid);
  border: none;
  border-radius: 6px;
  padding: 9px 18px;
  cursor: pointer;
  transition: all 0.15s;
  text-decoration: none;
}
.self-exam-link:hover { background: var(--rust); }

.upload-body { padding: 28px 26px; }

/* Upload buttons row */
.upload-btn-row {
  display: flex;
  gap: 12px;
  margin-bottom: 24px;
}

.upload-btn {
  display: inline-flex;
  align-items: center;
  gap: 9px;
  padding: 11px 22px;
  border-radius: 8px;
  font-family: 'Source Sans 3', sans-serif;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.18s;
  border: 1px solid;
}

.upload-btn-file {
  background: var(--ink);
  color: var(--cream);
  border-color: var(--ink);
}
.upload-btn-file:hover { background: var(--rust); border-color: var(--rust); }

.upload-btn-camera {
  background: var(--white);
  color: var(--ink);
  border-color: var(--border);
}
.upload-btn-camera:hover { border-color: var(--rust); color: var(--rust); background: var(--rust-light); }

.upload-hint { font-size: 12px; color: var(--muted); margin-top: 6px; }

/* Image preview area */
.image-preview-area {
  display: none;
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
  background: #fdfaf7;
}

.image-preview-area.visible { display: block; }

.image-preview-bar {
  padding: 10px 16px;
  background: var(--cream);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.image-preview-bar-left {
  display: flex;
  align-items: center;
  gap: 10px;
}

.image-preview-filename {
  font-size: 13px;
  font-weight: 600;
  color: var(--ink);
}

.image-preview-size {
  font-size: 12px;
  color: var(--muted);
}

.image-preview-actions {
  display: flex;
  gap: 8px;
  align-items: center;
}

.preview-action-btn {
  width: 30px;
  height: 30px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: var(--white);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  transition: all 0.15s;
  text-decoration: none;
  color: var(--ink);
}
.preview-action-btn:hover { border-color: var(--rust); color: var(--rust); }
.preview-action-btn.remove:hover { background: var(--rust); border-color: var(--rust); color: white; }

.image-preview-inner {
  padding: 20px;
  text-align: center;
}

.image-preview-inner img {
  max-height: 260px;
  max-width: 100%;
  border-radius: 8px;
  object-fit: contain;
}

/* Loading */
.loading-bar {
  display: none;
  margin-top: 16px;
  align-items: center;
  gap: 14px;
  padding: 14px 18px;
  background: var(--rust-light);
  border: 1px solid rgba(184,76,42,0.2);
  border-radius: 8px;
}
.loading-bar.visible { display: flex; }
.loading-spinner {
  width: 18px; height: 18px;
  border: 2px solid rgba(184,76,42,0.3);
  border-top-color: var(--rust);
  border-radius: 50%;
  animation: spin 0.7s linear infinite;
  flex-shrink: 0;
}
@keyframes spin { to { transform: rotate(360deg); } }
.loading-bar span { font-size: 13px; font-weight: 600; color: var(--rust); }

/* Poor quality warning */
.quality-warning {
  display: none;
  margin-top: 24px;
  padding: 18px 22px;
  background: #fff8e6;
  border: 1px solid #e8c84a;
  border-radius: 10px;
}
.quality-warning.visible { display: block; }
.quality-warning h4 { font-size: 14px; font-weight: 600; color: #7a5c00; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
.quality-warning p { font-size: 13px; color: #8a6a10; margin-bottom: 10px; line-height: 1.6; }
.quality-tips { list-style: none; display: flex; flex-direction: column; gap: 5px; }
.quality-tips li { font-size: 13px; color: #8a6a10; display: flex; align-items: flex-start; gap: 8px; }
.quality-tips li::before { content: "‚Üí"; color: #c98a2e; flex-shrink: 0; margin-top: 1px; }

/* RESULTS SECTION */
.results-section { display: none; }
.results-section.visible { display: block; }

.results-header {
  margin-bottom: 24px;
  display: flex;
  align-items: center;
  gap: 16px;
}
.results-header h2 { font-family: 'Playfair Display', serif; font-size: 22px; }

.results-grid-wrap {
  display: grid;
  grid-template-columns: 1fr 2px 1fr;
  gap: 0 28px;
  align-items: start;
}

.results-col-label {
  font-size: 10px;
  letter-spacing: 3px;
  text-transform: uppercase;
  font-weight: 600;
  margin-bottom: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.results-col-label .dot {
  width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0;
}
.benign-label { color: var(--sage); }
.benign-label .dot { background: var(--sage); }
.malignant-label { color: var(--rust); }
.malignant-label .dot { background: var(--rust); }

.img-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(2, auto);
  gap: 10px;
}

.img-card {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: 10px;
  overflow: hidden;
  cursor: pointer;
  transition: all 0.2s;
}
.img-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 24px rgba(0,0,0,0.1);
}
.benign-col .img-card:hover { border-color: var(--sage); }
.malignant-col .img-card:hover { border-color: var(--rust); }

.img-card img {
  width: 100%;
  aspect-ratio: 1 / 1;
  object-fit: cover;
  display: block;
}

.img-card-info {
  padding: 7px 9px;
}
.img-card-label {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 2px;
}
.benign-col .img-card-label { color: var(--sage); }
.malignant-col .img-card-label { color: var(--rust); }
.img-card-sim { font-size: 11px; color: var(--muted); }

/* Vertical divider */
.results-divider {
  width: 1px;
  background: var(--border);
  align-self: stretch;
  position: relative;
  min-height: 100%;
}
.results-divider::after {
  content: 'VS';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: var(--cream);
  padding: 6px 4px;
  font-size: 10px;
  font-weight: 600;
  color: var(--muted);
  letter-spacing: 1px;
}

/* LIGHTBOX */
#lightbox {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 9999;
  background: rgba(10,7,3,0.92);
  backdrop-filter: blur(10px);
  align-items: center;
  justify-content: center;
  padding: 24px;
}
#lightbox.open { display: flex; }

.lb-box {
  background: var(--white);
  border-radius: 16px;
  overflow: hidden;
  width: 100%;
  max-width: 880px;
  animation: lbIn 0.2s ease;
}
@keyframes lbIn { from { opacity:0; transform: scale(0.95); } to { opacity:1; transform: scale(1); } }

.lb-head {
  padding: 14px 20px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #fdfaf7;
}
.lb-head-info { display: flex; align-items: center; gap: 12px; }
.lb-head-title { font-family: 'Playfair Display', serif; font-size: 16px; }
.lb-badge {
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  padding: 3px 10px;
  border-radius: 20px;
}
.lb-badge-benign { background: var(--sage-light); color: var(--sage); }
.lb-badge-malignant { background: var(--rust-light); color: var(--rust); }

.lb-close {
  width: 32px; height: 32px; border-radius: 50%; border: 1px solid var(--border);
  background: none; cursor: pointer; font-size: 15px; color: var(--muted);
  display: flex; align-items: center; justify-content: center; transition: all 0.15s;
}
.lb-close:hover { background: var(--rust); border-color: var(--rust); color: white; }

.lb-body {
  display: grid;
  grid-template-columns: 1fr 1fr;
}

.lb-panel {
  padding: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
}
.lb-panel:first-child { border-right: 1px solid var(--border); }

.lb-panel img {
  width: 100%;
  max-height: 340px;
  object-fit: contain;
  border-radius: 8px;
  background: #f5f1eb;
}

.lb-panel-label {
  font-size: 12px;
  font-weight: 600;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 1.5px;
}
.lb-panel-sub { font-size: 12px; color: var(--muted); }

/* SELF-EXAM MODAL ‚Äî same as index.html */
#exam-modal {
  display: none; position: fixed; inset: 0; z-index: 9998;
  background: rgba(0,0,0,0.78); backdrop-filter: blur(6px);
  align-items: flex-start; justify-content: center;
  padding: 80px 20px 40px; overflow-y: auto;
}
#exam-modal.open { display: flex; }
.exam-box { background: var(--white); border-radius: 14px; width: 100%; max-width: 760px; overflow: hidden; animation: mIn 0.22s ease; position: relative; margin: auto; }
@keyframes mIn { from { opacity:0; transform:scale(.95) translateY(12px); } to { opacity:1; transform:scale(1) translateY(0); } }
.exam-head { padding: 20px 26px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
.exam-head h3 { font-family: 'Playfair Display', serif; font-size: 21px; }
.close-x { width: 32px; height: 32px; border-radius: 50%; border: 1px solid var(--border); background: none; color: var(--muted); font-size: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s; }
.close-x:hover { background: var(--rust); border-color: var(--rust); color: white; }
.exam-img-wrap { background: #f5f1eb; border-bottom: 1px solid var(--border); text-align: center; }
.exam-img-wrap img { max-width: 100%; max-height: 320px; object-fit: contain; display: block; margin: 0 auto; }
.exam-caption { padding: 9px 22px; font-size: 12px; color: var(--muted); text-align: center; border-bottom: 1px solid var(--border); background: #fdfaf7; }
.exam-body { padding: 22px 26px; }
.exam-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
.exam-step { background: var(--cream); border: 1px solid var(--border); border-radius: 8px; padding: 13px 15px; }
.exam-step .en { font-family: 'Playfair Display', serif; font-size: 20px; color: var(--rust-light); line-height: 1; margin-bottom: 5px; }
.exam-step .et { font-weight: 600; font-size: 13px; margin-bottom: 3px; }
.exam-step .ed { font-size: 12px; color: var(--muted); line-height: 1.5; }
.exam-signs h4 { font-weight: 600; font-size: 13px; margin-bottom: 9px; }
.exam-signs-list { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
.es-item { display: flex; align-items: flex-start; gap: 8px; font-size: 13px; color: var(--muted); }
.es-dot { width: 5px; height: 5px; background: var(--rust); border-radius: 50%; margin-top: 5px; flex-shrink: 0; }
.exam-foot { padding: 14px 26px; background: #fdfaf7; border-top: 1px solid var(--border); text-align: right; }
.exam-close-btn { background: var(--ink); color: var(--cream); font-family: 'Source Sans 3', sans-serif; font-size: 13px; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; border: none; padding: 10px 26px; border-radius: 4px; cursor: pointer; transition: background 0.2s; }
.exam-close-btn:hover { background: var(--rust); }

footer {
  text-align: center;
  margin-top: 80px;
  padding: 36px 40px;
  background: var(--dark);
  color: #706860;
}
.footer-logo { font-family: 'Playfair Display', serif; font-size: 18px; color: #a09890; margin-bottom: 10px; }
.footer-logo span { color: var(--rust-mid); }
footer p { font-size: 13px; line-height: 1.7; max-width: 480px; margin: 0 auto; }
.footer-disc { margin-top: 18px; padding-top: 18px; border-top: 1px solid #2a2520; font-size: 12px; color: #4a4440; }

/* Hidden file inputs */
#fileInput, #cameraInput { display: none; }

@media (max-width: 700px) {
  nav { padding: 0 16px; }
  .page { padding: 84px 20px 48px; }
  .results-grid-wrap { grid-template-columns: 1fr; }
  .results-divider { display: none; }
  .lb-body { grid-template-columns: 1fr; }
  .lb-panel:first-child { border-right: none; border-bottom: 1px solid var(--border); }
  .exam-grid { grid-template-columns: 1fr; }
  .exam-signs-list { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <a class="nav-logo" href="index.html">
    <div class="logo-mark">+</div>
    <div class="logo-text">Oral<span>Guard</span></div>
  </a>
  <div class="nav-links">
    <a class="nav-link" href="index.html">Home</a>
    <a class="nav-link" href="Questionnaire.html">Risk Screener</a>
    <a class="nav-link active" href="matcher.html">Image Matcher</a>
  </div>
</nav>

<!-- SELF-EXAM MODAL -->
<div id="exam-modal" onclick="if(event.target===this)closeExam()">
  <div class="exam-box">
    <div class="exam-head">
      <h3>Oral Self-Examination Guide</h3>
      <button class="close-x" onclick="closeExam()">‚úï</button>
    </div>
    <div class="exam-img-wrap">
      <img src="img.png" alt="Oral self-exam diagram" onerror="this.style.display='none'">
    </div>
    <div class="exam-caption">Check all highlighted areas monthly ‚Äî takes 5 minutes</div>
    <div class="exam-body">
      <div class="exam-grid">
        <div class="exam-step"><div class="en">01</div><div class="et">Lips &amp; Corners</div><div class="ed">Pull lips away from teeth. Look for sores or colour changes on the lips and corners.</div></div>
        <div class="exam-step"><div class="en">02</div><div class="et">Inner Cheeks &amp; Gums</div><div class="ed">Pull each cheek sideways. Look for red, white, or mixed patches. Feel for lumps.</div></div>
        <div class="exam-step"><div class="en">03</div><div class="et">Tongue ‚Äî All Sides</div><div class="ed">Stick out tongue. Check top, then inspect sides and underside ‚Äî the most common cancer site.</div></div>
        <div class="exam-step"><div class="en">04</div><div class="et">Floor of Mouth</div><div class="ed">Press tongue to roof of mouth. Check underneath for swelling, sores, or colour changes.</div></div>
        <div class="exam-step"><div class="en">05</div><div class="et">Palate (Roof)</div><div class="ed">Tilt head back, open wide. Look for lumps or changes on the hard and soft palate.</div></div>
        <div class="exam-step"><div class="en">06</div><div class="et">Throat &amp; Neck</div><div class="ed">Say "Aah" and check the back of your throat. Feel along your neck for enlarged lymph nodes.</div></div>
      </div>
      <div class="exam-signs">
        <h4>Report any of these to a dentist:</h4>
        <div class="exam-signs-list">
          <div class="es-item"><div class="es-dot"></div>Sore not healed in 3 weeks</div>
          <div class="es-item"><div class="es-dot"></div>Red or white patch that won't wipe off</div>
          <div class="es-item"><div class="es-dot"></div>Lump or rough thickening</div>
          <div class="es-item"><div class="es-dot"></div>Persistent pain or numbness</div>
          <div class="es-item"><div class="es-dot"></div>Difficulty chewing or swallowing</div>
          <div class="es-item"><div class="es-dot"></div>Hoarse voice lasting 3+ weeks</div>
          <div class="es-item"><div class="es-dot"></div>Swollen neck node 3+ weeks</div>
          <div class="es-item"><div class="es-dot"></div>Unexplained weight loss</div>
        </div>
      </div>
    </div>
    <div class="exam-foot">
      <button class="exam-close-btn" onclick="closeExam()">Close Guide</button>
    </div>
  </div>
</div>

<!-- LIGHTBOX -->
<div id="lightbox" onclick="if(event.target===this)closeLightbox()">
  <div class="lb-box">
    <div class="lb-head">
      <div class="lb-head-info">
        <div class="lb-head-title">Visual Comparison</div>
        <span id="lb-badge" class="lb-badge"></span>
        <span id="lb-sim" style="font-size:13px; color:var(--muted);"></span>
      </div>
      <button class="lb-close" onclick="closeLightbox()">‚úï</button>
    </div>
    <div class="lb-body">
      <div class="lb-panel">
        <span class="lb-panel-label">Matched Case</span>
        <img id="lb-match-img" src="" alt="Matched case">
        <span id="lb-match-label" class="lb-panel-sub"></span>
      </div>
      <div class="lb-panel">
        <span class="lb-panel-label">Your Image</span>
        <img id="lb-user-img" src="" alt="Your uploaded image">
        <span class="lb-panel-sub">Uploaded image</span>
      </div>
    </div>
  </div>
</div>

<!-- PAGE -->
<div class="page">

  <div class="page-header">
    <div class="page-badge">‚óè Visual Comparison Tool</div>
    <h1>AI Image Matcher</h1>
    <p>Upload a photo of an oral lesion. The AI retrieves the top 6 most visually similar benign and malignant cases from our clinical image database.</p>
  </div>

  <!-- UPLOAD SECTION -->
  <div class="upload-section">
    <div class="upload-section-head">
      <h2>Upload Lesion Image</h2>
      <button class="self-exam-link" onclick="openExam()">Self-Exam Guide</button>
    </div>
    <div class="upload-body">
      <div class="upload-btn-row">
        <button class="upload-btn upload-btn-file" onclick="document.getElementById('fileInput').click()">
          <span>üìÅ</span> Upload File
        </button>
        <button class="upload-btn upload-btn-camera" onclick="document.getElementById('cameraInput').click()">
          <span>üì∑</span> Open Camera
        </button>
      </div>
      <div class="upload-hint">Accepted: JPG, PNG, WEBP ‚Äî max one image at a time</div>

      <input type="file" id="fileInput" accept="image/*">
      <input type="file" id="cameraInput" accept="image/*" capture="environment">

      <!-- Image preview -->
      <div class="image-preview-area" id="imagePreviewArea">
        <div class="image-preview-bar">
          <div class="image-preview-bar-left">
            <span style="font-size:18px;">üñº</span>
            <div>
              <div class="image-preview-filename" id="previewFilename">image.jpg</div>
              <div class="image-preview-size" id="previewSize">‚Äî</div>
            </div>
          </div>
          <div class="image-preview-actions">
            <a id="downloadBtn" class="preview-action-btn" download title="Download image">‚¨á</a>
            <button class="preview-action-btn remove" onclick="removeImage()" title="Remove image">‚úï</button>
          </div>
        </div>
        <div class="image-preview-inner">
          <img id="previewImg" src="" alt="Preview">
        </div>
      </div>

      <!-- Loading bar -->
      <div class="loading-bar" id="loadingBar">
        <div class="loading-spinner"></div>
        <span>Analyzing image against clinical database‚Ä¶</span>
      </div>
    </div>
  </div>

  <!-- Quality warning -->
  <div class="quality-warning" id="qualityWarning">
    <h4>‚ö† Low Similarity Detected ‚Äî Consider Retaking the Photo</h4>
    <p>More than half of the matched images have similarity scores below 55%, which may indicate the uploaded image is unclear or not well-suited for matching.</p>
    <ul class="quality-tips">
      <li>Ensure the area is well-lit ‚Äî use a flashlight or bright natural light</li>
      <li>Make sure the lesion is clearly in the centre of the frame</li>
      <li>Hold the camera steady and close enough to see texture clearly</li>
      <li>Avoid blurry or out-of-focus images ‚Äî check sharpness before uploading</li>
      <li>Remove any obstructions such as fingers, shadows, or dental tools</li>
      <li>Use the camera's macro or portrait mode if available</li>
    </ul>
  </div>

  <!-- RESULTS -->
  <div class="results-section" id="resultsSection">
    <div class="results-header">
      <h2>Matched Cases</h2>
      <span style="font-size:13px; color:var(--muted);">Click any image to compare with your photo</span>
    </div>

    <div class="results-grid-wrap">
      <!-- Benign column -->
      <div class="benign-col">
        <div class="results-col-label benign-label">
          <div class="dot"></div>Benign Matches
        </div>
        <div class="img-grid" id="benignGrid"></div>
      </div>

      <!-- Divider -->
      <div class="results-divider"></div>

      <!-- Malignant column -->
      <div class="malignant-col">
        <div class="results-col-label malignant-label">
          <div class="dot"></div>Malignant Matches
        </div>
        <div class="img-grid" id="malignantGrid"></div>
      </div>
    </div>
  </div>

</div>

<footer>
  <div class="footer-logo">Oral<span>Guard</span></div>
  <p>A research and educational screening platform. Not a substitute for professional clinical evaluation.</p>
  <div class="footer-disc">‚ö† This tool does not provide medical diagnoses. Always consult a qualified dentist, oral surgeon, or oncologist.</div>
</footer>

<script>
let userImageDataUrl = null;

// --- File inputs ---
document.getElementById('fileInput').addEventListener('change', function() {
  handleFile(this.files[0]);
});
document.getElementById('cameraInput').addEventListener('change', function() {
  handleFile(this.files[0]);
});

function handleFile(file) {
  if (!file) return;
  if (!file.type.startsWith('image/')) {
    alert('Please select an image file (JPG, PNG, or WEBP).');
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    userImageDataUrl = e.target.result;

    // Show preview
    document.getElementById('previewImg').src = userImageDataUrl;
    document.getElementById('previewFilename').textContent = file.name;
    document.getElementById('previewSize').textContent = formatFileSize(file.size);
    document.getElementById('downloadBtn').href = userImageDataUrl;
    document.getElementById('downloadBtn').download = file.name;
    document.getElementById('imagePreviewArea').classList.add('visible');

    // Hide old results / warnings
    document.getElementById('resultsSection').classList.remove('visible');
    document.getElementById('qualityWarning').classList.remove('visible');

    // Auto-analyze
    analyzeImage(file);
  };
  reader.readAsDataURL(file);
}

function removeImage() {
  userImageDataUrl = null;
  document.getElementById('previewImg').src = '';
  document.getElementById('imagePreviewArea').classList.remove('visible');
  document.getElementById('resultsSection').classList.remove('visible');
  document.getElementById('qualityWarning').classList.remove('visible');
  document.getElementById('loadingBar').classList.remove('visible');
  document.getElementById('fileInput').value = '';
  document.getElementById('cameraInput').value = '';
}

function formatFileSize(bytes) {
  if (bytes < 1024) return bytes + ' B';
  if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
  return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
}

async function analyzeImage(file) {
  document.getElementById('loadingBar').classList.add('visible');
  document.getElementById('benignGrid').innerHTML = '';
  document.getElementById('malignantGrid').innerHTML = '';

  const formData = new FormData();
  formData.append('file', file);

  try {
    const response = await fetch(
      'https://gprabhanjana-oral-cancer-cbir-api.hf.space/search',
      { method: 'POST', body: formData }
    );
    const data = await response.json();
    document.getElementById('loadingBar').classList.remove('visible');

    const benign = (data.results.benign || []).slice(0, 6);
    const malignant = (data.results.malignant || []).slice(0, 6);

    // Quality check: > half of all 12 results below 55%
    const allResults = [...benign, ...malignant];
    const lowCount = allResults.filter(r => r.similarity < 0.55).length;
    if (lowCount > allResults.length / 2) {
      document.getElementById('qualityWarning').classList.add('visible');
    } else {
      document.getElementById('qualityWarning').classList.remove('visible');
    }

    renderGrid(benign, 'benignGrid', 'benign');
    renderGrid(malignant, 'malignantGrid', 'malignant');
    document.getElementById('resultsSection').classList.add('visible');

  } catch (err) {
    document.getElementById('loadingBar').classList.remove('visible');
    alert('Error connecting to the AI service. Please try again.');
  }
}

function renderGrid(results, containerId, type) {
  const container = document.getElementById(containerId);
  results.forEach(r => {
    const card = document.createElement('div');
    card.className = 'img-card';
    card.innerHTML = `
      <img src="${r.image_path}" alt="${r.label}" loading="lazy">
      <div class="img-card-info">
        <div class="img-card-label">${r.label}</div>
        <div class="img-card-sim">${(r.similarity * 100).toFixed(1)}% match</div>
      </div>
    `;
    card.addEventListener('click', () => openLightbox(r, type));
    container.appendChild(card);
  });
}

// --- Lightbox ---
function openLightbox(result, type) {
  document.getElementById('lb-match-img').src = result.image_path;
  document.getElementById('lb-user-img').src = userImageDataUrl || '';
  document.getElementById('lb-match-label').textContent = result.label + ' ‚Äî ' + (result.similarity * 100).toFixed(1) + '% similarity';

  const badge = document.getElementById('lb-badge');
  badge.textContent = type === 'benign' ? 'Benign' : 'Malignant';
  badge.className = 'lb-badge ' + (type === 'benign' ? 'lb-badge-benign' : 'lb-badge-malignant');

  document.getElementById('lb-sim').textContent = '';

  document.getElementById('lightbox').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeLightbox() {
  document.getElementById('lightbox').classList.remove('open');
  document.body.style.overflow = '';
}

// --- Self-Exam Modal ---
function openExam() {
  document.getElementById('exam-modal').classList.add('open');
  document.body.style.overflow = 'hidden';
}
function closeExam() {
  document.getElementById('exam-modal').classList.remove('open');
  document.body.style.overflow = '';
}

document.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    closeLightbox();
    closeExam();
  }
});
</script>

</body>
</html>